<head>

	<title>GoBBit - Reddit's like Forum software written in Golang</title>

	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

	<!-- CSS -->
	<link rel="stylesheet" href="/css/vendor/kube.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="/css/gobbit.css">

	<!-- JS Libs -->
	<script src="/js/vendor/jquery.js"></script>
	<script src="/js/vendor/kube.min.js"></script>
	<script src="/js/vendor/moment.js"></script>
	<script src="/js/vendor/angular.min.js"></script>

</head>

<body ng-app="GoBBit">

	<div ng-controller="App" ng-init="user={};topics=[];communities=[];community=null;">

		<div id="navbar" class="sticky">
			<nav id="navbar-main" class="row">
				<ul class="col col-10" style="display: block;list-style-type: none;">
					<li><a ng-click="getHomeTopics(0)" href="#!">{{ translation.home }}</a></li>
					<li><a href="#!">{{ translation.recent }}</a></li>
				</ul>

				<ul class="col col-2" style="display: block;list-style-type: none;">
					<!-- Log out and user info -->
					<li ng-if="user.username"><a href="#!">{{ user.username }}</a></li>
					<li ng-if="user.username"><a href="/logout">{{ translation.logout }}</a></li>
				</ul>
			</nav>
		</div>

		<center>
			<div style="width:80%;">
				<h3>Welcome to GoBBit</h3>
				<i>Reddit's like Forum software written in Golang</i>

				<!-- Login / registration form -->
				<div class="row around" ng-if="!user.username" style="padding:10px">
					<div ng-controller="login" class="col col-6">
						<div class="form-item">
							<label>Username</label>
							<input type="text" name="username" ng-model="username" class="width-50">
						</div>
						<div class="form-item">
							<label>Password</label>
							<input type="password" name="password" ng-model="password" class="width-50">
						</div>

						<br>
						<button ng-click="login()" class="button primary width-35">{{ translation.login }}</button>
					</div>

					<div ng-controller="register" class="col col-6">
						<div class="form-item">
							<label>Username</label>
							<input type="text" name="username" ng-model="username" class="width-50">
						</div>
						<div class="form-item">
							<label>Email</label>
							<input type="email" name="email" ng-model="email" class="width-50">
						</div>
						<div class="form-item">
							<label>Password</label>
							<input type="password" name="password" ng-model="password" class="width-50">
						</div>
						<div class="form-item">
							<label>Repeat Password</label>
							<input type="password" name="rpassword" ng-model="rpassword" class="width-50">
						</div>

						<br>
						<button ng-click="register()" class="button primary width-35">{{ translation.register }}</button>
					</div>
				</div>

			</div>
		</center>

		<!-- Communities Dropdown and New topic button -->
		<div style="left: 10%;position: relative;margin:5px">
			<button data-component="dropdown" data-target="#communities-dropdown">Communities<span class="caret down"></span></button>

			<button ng-click="openTopicComposer()" class="button primary">{{ translation.new_topic }}</button>
		</div>
		<div class="dropdown" id="communities-dropdown">
			<center>
				
				<ul class="communities">
					<li ng-click="setCommunity($index)" style="float:none;" ng-repeat="c in communities"><a class="community" href="#!">{{ c.name }}</a></li>
				</ul>

				<a href="#!" data-action="dropdown-close">Close</a>
			</center>
		</div>

		<!-- Commnity info (if selected) -->
		<center ng-if="community" class="width-80 bgimage" style="background-image:url({{ community.picture }});">
			<div class="blurcontent">
				<h2 style="color:white">{{ community.name }}</h2>
				<i>{{ community.description }}</i>
				<br>
				<i><b>{{ translation.created }}</b>: {{ formatDateComplete(community.creation_date) }}</i>

				<div class="row centered">
					<div class="col-1">
						<i class="fa fa-pencil" aria-hidden="true"></i>
						{{ community.posts_number }}
					</div>
					<div class="col-1">
						<i class="fa fa-comments" aria-hidden="true"></i>
						{{ community.topics_number }}
					</div>
					<div class="col-1">
						<i class="fa fa-user-md" aria-hidden="true"></i>
						{{ community.mods.length }}
					</div>
				</div>

				<div class="follow_community_btn">
					<button ng-if="user.followed_communities.indexOf(community.slug) < 0" class="button inverted outline" ng-click="followCommunity(community.slug)">
						{{ translation.follow }}
					</button>
					<button ng-if="user.followed_communities.indexOf(community.slug) >= 0" class="button red outline" ng-click="unfollowCommunity(community.slug)">
						{{ translation.unfollow }}
					</button>
				</div>

			</div>
		</center>

		<!-- Topics table -->
		<center>
			<table class="striped" style="width:80%">
				<thead>
			        <tr>
			            <th class="width-50">{{ translation.title }}</th>
			            <th class="width-30">{{ translation.community }}</th>
			            <th class="width-20">{{ translation.last_update }}</th>
			        </tr>
			    </thead>
			    <tbody>
			        <tr ng-repeat="t in topics">
			            <td class="width-50">
			            	<b><a href="#!" ng-click="loadTopic(t.id)">{{ t.title }}</a></b>
			            	<br>
			            	<a href="#!" style="color:black;font-size:12px">{{ t.user.username }}</a>
			            </td>
			            <td class="width-30">
			            	<a href="#!" ng-click="setCommunityBySlug(t.community)">
			            		{{ t.community }}
			            	</a>
			            </td>
			            <td class="width-20">{{ formatDate(t.last_update) }}</td>
			        </tr>
			    </tbody>
			</table>

			<a href="#!" ng-click="loadMoreTopics()">{{ translation.load_more }}</a>
		</center>




		<!-- Topic content (messages..) -->
		<center id="topicModal" class="topicmodal hide" ng-controller="topic" ng-init="topic={};tid='';posts=[];page=0;pages=0;">
			<a class="closemodal" ng-click="closeModal()" href="#!">{{ translation.close }}</a>
			<div class="width-80">
				<h2>{{ topic.title }}</h2>
				<div class="row">
					<div class="col col-3">
						<img ng-src="{{ topic.user.picture }}">
						<a href="#!">{{ topic.user.username }}</a>
					</div>
					<div class="col col-9">
						{{ topic.content }}
					</div>
				</div>

				<!-- topic posts -->
				<div>
					<div class="row" ng-repeat="p in posts">
						<div class="col col-3">
							<img ng-src="{{ p.user.picture }}">
							<a href="#!">{{ p.user.username }}</a>
						</div>
						<div class="col col-9">
							{{ p.content }}
						</div>
					</div>
				</div>

				<nav class="pagination centered">
				    <ul>
				        <li class="prev"><a href="#!" ng-click="prevPage()">&larr;</a></li>
				        <li>
				            <ul>
				                <li ng-repeat="i in rangeSimple(1, pages, 1)"><a href="#!" ng-click="getTopicPostsByPage(i-1)">{{ i }}</a></li>
				            </ul>
				        </li>
				        <li class="next"><a href="#!" ng-click="nextPage()">&rarr;</a></li>
				    </ul>
				</nav>

				<!-- post reply -->
				<div class="row centered">
					<div class="col col-5" style="height:200px;">
						<h4>{{ translation.reply }}</h4>
						<textarea ng-model="replyTxt" style="height:200px;max-height:200px;"></textarea>

						<br>
						<button ng-click="sendReply()" ng-disabled="!user.username" class="button primary">{{ translation.reply }}</button>
					</div>

					<div class="col col-5">
						<h4>{{ translation.preview }}</h4>
						<!-- preview (TODO) -->
						<div style="max-height:200px;height:200px;overflow:auto;">
						</div>
					</div>
				</div>

			</div>
		</center>


		<!-- Topic composer -->
		<center id="topicComposerModal" class="topicmodal hide" ng-controller="topic-composer" ng-init="title='';selectedCommunity=null;">
			<a class="closemodal" ng-click="closeModal()" href="#!">{{ translation.close }}</a>
			<div class="width-80">
				<!-- Communities Dropdown -->
				<div align="left" style="margin:5px">
					<button data-component="dropdown" data-target="#composer-communities-dropdown">{{ selectedCommunity || translation.select_community }}<span class="caret down"></span></button>

					<!-- Title -->
					<input type="text" class="width-50" placeholder="{{ translation.title }}" ng-model="titleTxt"/>
				</div>
				<div class="dropdown" id="composer-communities-dropdown">
					<center>
						
						<ul class="communities">
							<li ng-click="setCommunity(c.slug)" style="float:none;" ng-repeat="c in communities"><a class="community" href="#!">{{ c.name }}</a></li>
						</ul>

						<a href="#!" data-action="dropdown-close">Close</a>
					</center>
				</div>

				<!-- content composer -->
				<div class="row centered">
					<div class="col col-5" style="height:200px;">
						<h4>{{ translation.reply }}</h4>
						<textarea ng-model="contentTxt" style="height:200px;max-height:200px;"></textarea>

						<br>
						<button ng-click="sendTopic()" ng-disabled="!user.username" class="button primary">{{ translation.reply }}</button>
					</div>

					<div class="col col-5">
						<h4>{{ translation.preview }}</h4>
						<!-- preview (TODO) -->
						<div style="max-height:200px;height:200px;overflow:auto;">
						</div>
					</div>
				</div>

			</div>
		</center>



	</div>

	<script type="text/javascript">
		var myApp = angular.module('GoBBit',[]);
	</script>

	<!-- Angular Controllers -->
	<script type="text/javascript" src="/js/appcontroller.js"></script>
	<script type="text/javascript" src="/js/logincontroller.js"></script>
	<script type="text/javascript" src="/js/registercontroller.js"></script>
	<script type="text/javascript" src="/js/topiccontroller.js"></script>
	<script type="text/javascript" src="/js/topic-composercontroller.js"></script>

</body>